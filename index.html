<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>쿠파의 피치 공주 잡기 게임</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: #000;
      font-family: "Baloo 2", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #game-container {
      width: 800px;
      height: 600px;
      background: url("https://i.pinimg.com/736x/a8/1e/27/a81e27defcb9f945ee78a7a247b808cc.jpg") center/cover no-repeat;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }
    #game-area {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .princess {
      position: absolute;
      background-size: contain;
      background-repeat: no-repeat;
      cursor: pointer;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .princess:hover {
      transform: scale(1.1);
    }

    /* 공통 패널 디자인 */
    .infoPanel {
      position: absolute;
      top: 20px;
      background: linear-gradient(to bottom, #0b223a, #001020);
      border: 2px solid #003366;
      border-radius: 6px;
      padding: 6px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: inset 0 0 6px #000, 0 0 6px rgba(0,0,0,0.6);
    }
    #scorePanel { left: 20px; }
    #timePanel { right: 20px; width: 180px; justify-content: space-between; }

    .label {
      color: #fff;
      font-size: 12px;
      font-family: sans-serif;
    }
    .value {
      font-family: 'Orbitron', monospace;
      font-size: 28px;
      color: #FFD700;
      letter-spacing: 2px;
      text-shadow: 0 0 6px rgba(255, 215, 0, 0.8), 0 0 12px rgba(255, 215, 0, 0.5);
      min-width: 80px;
      text-align: right;
    }

    /* 빠른 공주 효과 */
    .fast {
      filter: drop-shadow(0 0 6px red) drop-shadow(0 0 12px red);
    }

    /* 팝업 스타일 */
    .popup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 25px 35px;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.25);
      text-align: center;
      display: none;
      z-index: 1000;
      min-width: 420px;
    }
    .popup h2 {
      margin: 0 0 15px;
      color: #ff4f81;
      font-size: 20px;
      white-space: nowrap;
    }
    .popup p {
      margin: 8px 0;
      font-size: 14px;
      color: #333;
    }
    .popup button {
      margin-top: 10px;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      background: #ff4f81;
      color: white;
      font-size: 14px;
      cursor: pointer;
      font-family: "Baloo 2", sans-serif;
    }
    .popup button:hover {
      background: #e63b6c;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="game-area"></div>

    <!-- 점수 패널 -->
    <div id="scorePanel" class="infoPanel">
      <div class="label">잡은 피치 공주</div>
      <div id="scoreValue" class="value">0</div>
    </div>

    <!-- 시간 패널 -->
    <div id="timePanel" class="infoPanel">
      <div class="label">남은 시간</div>
      <div id="timeValue" class="value">30.00</div>
    </div>

    <!-- 규칙 팝업 -->
    <div id="rulePopup" class="popup" style="display:block;">
      <h2>게임 규칙</h2>
      <p>1. 30초 안에 20점을 달성해야 합니다.</p>
      <p>2. 피치 공주를 잡으면 점수가 증가합니다.</p>
      <p>3. 다른 공주를 잡으면 점수가 감소합니다.</p>
      <p>4. 빠르게 이동하는 피치 공주를 잡으면 점수가 많이 증가합니다.</p>
      <button onclick="startGame()">시작하기</button>
    </div>

    <!-- 성공 팝업1 -->
    <div id="popup1" class="popup">
      <h2>성공! 피치 공주를 만족스럽게 잡았습니다!</h2>
      <button onclick="showSecondPopup()">확인</button>
    </div>

    <!-- 성공 팝업2 -->
    <div id="popup2" class="popup">
      <h2>힌트 문장 5</h2>
      <p>다리 난간에는 불꽃 모양의 조각상이 줄지어 서 있다.</p>
      <button onclick="closePopup()">닫기</button>
    </div>

    <!-- 실패 팝업 -->
    <div id="failPopup" class="popup">
      <h2>실패.. 피치 공주를 충분히 잡지 못했습니다..</h2>
      <button onclick="closePopup()">닫기</button>
    </div>
  </div>

  <script>
    const gameArea = document.getElementById("game-area");
    const scoreValue = document.getElementById("scoreValue");
    const timeValue = document.getElementById("timeValue");
    const popup1 = document.getElementById("popup1");
    const popup2 = document.getElementById("popup2");
    const failPopup = document.getElementById("failPopup");
    const rulePopup = document.getElementById("rulePopup");

    let score = 0;
    let timeLeft = 30.00;
    let gameInterval, spawnInterval;
    const targetScore = 20;
    let gameRunning = false;

    const princesses = [
      { name: "peach", img: "https://www.nicepng.com/png/full/168-1685188_princess-peach-clipart-new-super-mario-bros-princess.png" },
      { name: "elsa", img: "https://www.nicepng.com/png/full/881-8812197_adesivo-frozen-elsa-princess-elsa.png" },
      { name: "snowwhite", img: "https://www.nicepng.com/png/full/328-3286991_snow-white-disney-png.png" },
      { name: "cinderella", img: "https://www.nicepng.com/png/full/6-65975_cinderella-cinderella-png.png" }
    ];

    function isOverlap(x, y, others, size = 80) {
      for (let o of others) {
        if (Math.abs(x - o.x) < size && Math.abs(y - o.y) < size) {
          return true;
        }
      }
      return false;
    }

    function spawnPrincesses() {
      const count = Math.floor(Math.random() * 4) + 3; 
      const positions = [];
      const usedNames = new Set();

      for (let i = 0; i < count; i++) {
        let princessData;
        let tries = 0;
        do {
          princessData = princesses[Math.floor(Math.random() * princesses.length)];
          tries++;
        } while (usedNames.has(princessData.name) && tries < 10);

        usedNames.add(princessData.name);

        let size = 50 + Math.random() * 60;
        let x, y, posTries = 0;
        do {
          x = Math.random() * (gameArea.clientWidth - size);
          y = Math.random() * (gameArea.clientHeight - size);
          posTries++;
        } while (isOverlap(x, y, positions, size) && posTries < 20);
        positions.push({x, y});

        const princess = document.createElement("div");
        princess.classList.add("princess");
        princess.style.backgroundImage = `url(${princessData.img})`;
        princess.style.left = x + "px";
        princess.style.top = y + "px";
        princess.style.width = size + "px";
        princess.style.height = size + "px";

        let dx = (Math.random() < 0.5 ? -1 : 1) * (4 + Math.random() * 3);
        let dy = (Math.random() < 0.5 ? -1 : 1) * (4 + Math.random() * 3);

        let isFast = false;
        if (Math.random() < 0.2) {
          dx *= 2;
          dy *= 2;
          princess.classList.add("fast");
          isFast = true;
        }

        princess.addEventListener("click", () => {
          if (princessData.name === "peach") {
            if (isFast) {
              score += 3;
            } else {
              score++;
            }
          } else {
            score = Math.max(0, score - 1);
          }
          scoreValue.textContent = score;
          if (score >= targetScore) {
            endGame(true);
          }
          princess.remove();
        });

        gameArea.appendChild(princess);

        const moveInterval = setInterval(() => {
          if (!gameArea.contains(princess)) {
            clearInterval(moveInterval);
            return;
          }
          let newX = princess.offsetLeft + dx;
          let newY = princess.offsetTop + dy;
          if (newX <= 0 || newX >= gameArea.clientWidth - size) dx *= -1;
          if (newY <= 0 || newY >= gameArea.clientHeight - size) dy *= -1;
          princess.style.left = (princess.offsetLeft + dx) + "px";
          princess.style.top = (princess.offsetTop + dy) + "px";
        }, 30);

        setTimeout(() => {
          if (gameArea.contains(princess)) {
            princess.style.opacity = "0";
            setTimeout(() => princess.remove(), 300);
          }
        }, 2500);
      }
    }

    function startGame() {
      if (gameRunning) return;
      rulePopup.style.display = "none";
      gameRunning = true;

      gameInterval = setInterval(() => {
        timeLeft -= 0.01;
        if (timeLeft <= 0) {
          clearInterval(gameInterval);
          timeValue.textContent = "0.00";
          endGame(false);
        } else {
          timeValue.textContent = timeLeft.toFixed(2);
        }
      }, 10);

      spawnInterval = setInterval(spawnPrincesses, 1300);
    }

    function endGame(earlyWin = false) {
      clearInterval(gameInterval);
      clearInterval(spawnInterval);
      document.querySelectorAll(".princess").forEach(p => p.remove());
      gameRunning = false;

      if (score >= targetScore || earlyWin) {
        popup1.style.display = "block";
      } else {
        failPopup.style.display = "block";
      }
    }

    function showSecondPopup() {
      popup1.style.display = "none";
      popup2.style.display = "block";
    }

    function closePopup() {
      popup1.style.display = "none";
      popup2.style.display = "none";
      failPopup.style.display = "none";
    }
  </script>
</body>
</html>
